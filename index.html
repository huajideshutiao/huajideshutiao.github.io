<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜…è¯»ä¹¦æºæŒ‡å—</title>
    <style>
        body {
            line-height: 1.6;
            margin: 20px;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background-color: #F7F8FA;
            padding: 15px 20px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            background-color: #F0F1F3;
            padding: 3px 5px;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<h1>é˜…è¯»ä¹¦æºæŒ‡å—</h1>
<p>æœ¬æŒ‡å—å‚è€ƒäº†å–µå…¬å­çš„è§„åˆ™è¯´æ˜å’Œé˜…è¯»ä»“åº“çš„jshelpç­‰æ–‡æ¡£ï¼Œéœ€è¦æœ‰ä¸€å®šåŸºç¡€ã€‚</p>

<h2>å·¥å…·ç®±</h2>
<ul>
    <li><a href="https://www.toolhelper.cn/Char/RegexTest">æ­£åˆ™è¡¨è¾¾å¼</a></li>
    <li><a href="https://www.toolhelper.cn/EncodeDecode/Url">urlç¼–è§£ç </a></li>
    <li><a href="https://try.jsoup.org/">cssé€‰æ‹©å™¨</a></li>
    <li><a href="https://www.jsonpath.cn/">JSONPath</a></li>
</ul>

<h2>urlé™„åŠ å‚æ•°</h2>
<pre>
https://www.baidu.com,{
    "charset": "è¿™é‡Œæ˜¯ç¼–ç ",
    "method": "POST",
    "body": "......",
    "headers": {......},
    "js": "è§£æå®Œurlå‚æ•°æ—¶æ‰§è¡Œï¼Œç»“æœä¼šèµ‹å€¼ç»™url",
    "webView": true,
    "proxy": "socks5://127.0.0.1:1080@ç”¨æˆ·å@å¯†ç "
}
</pre>
<p>é…ç½®éœ€è¦çš„é¡¹ç›®å³å¯ï¼Œå®Œæ•´å‚æ•°è§<a href="https://github.com/gedoor/legado/blob/master/app/src/main/java/io/legado/app/model/analyzeRule/AnalyzeUrl.kt">æ­¤å¤„</a>çš„<code>data class UrlOption()</code></p>

<h2>å¸¸ç”¨å†…ç½®å˜é‡åŠå‡½æ•°</h2>
<p>å®Œæ•´å‡½æ•°å¯ä»¥å‰å¾€<a href="https://github.com/gedoor/legado/blob/master/app/src/main/assets/web/help/md/jsHelp.md">jsHelp.md</a>å’Œ<a href="https://github.com/gedoor/legado/blob/master/app/src/main/java/io/legado/app/help/JsExtensions.kt">JsExtensions.kt</a></p>
<p><a href="/ç™»å½•æ£€æŸ¥.html">æ–¹æ³•-ç™»å½•æ£€æŸ¥JS.md</a>å’Œ<a href="/JSæ‰©å±•ç±».html">æ–¹æ³•-JSæ‰©å±•ç±».md</a>ä¹Ÿæœ‰å‡½æ•°åˆ—è¡¨(ç‰¹åˆ«æ„Ÿè°¢<a href="https://srcbbs.com/home.php?mod=space&uid=5167&do=profile">æ˜æœˆç…§å¤§æ±Ÿ</a>æä¾›)</p>
<ul>
    <li><code>baseUrl</code> - å½“å‰url</li>
    <li><code>result</code> - ä¸Šä¸€æ­¥çš„ç»“æœ</li>
    <li><code>title</code> - ç« èŠ‚å½“å‰æ ‡é¢˜</li>
    <li><code>src</code> - è¯·æ±‚è¿”å›çš„æºç </li>
</ul>

<h3>å½“å‰ç±»éƒ¨åˆ†å‡½æ•°</h3>
<pre>//è®¾ç½®é¡µé¢æºç å’Œè§£æå…ƒç´ 
java.setContent(content: Any?, baseUrl: String? = null)
java.getElement(ruleStr: String)
java.getElements(ruleStr: String)

//åˆ·æ–°ä¹¦ç±å’Œç›®å½•
java.reGetBook()
java.refreshTocUrl()

//å˜é‡å­˜å–
java.get(key)
java.put(key, value)

//ç½‘ç»œè¯·æ±‚
java.ajax(urlStr): String
java.ajaxAll(urlList: Array<String>): Array<StrResponse?>
java.connect(urlStr): StrResponse
java.post(url: String, body: String, headerMap: Map<String, String>): Connection.Response
java.get(url: String, headerMap: Map<String, String>): Connection.Response
java.head(url: String, headerMap: Map<String, String>): Connection.Response
java.startBrowser(url: String, title: String)
java.startBrowserAwait(url: String, title: String, refetchAfterSuccess: Boolean? = true): StrResponse

//æç¤º
java.log(msg)
java.logType(var)
java.longToast(msg: Any?)
java.toast(msg: Any?)

//charsetå¯ä¸å†™
java.strToBytes(str: String, charset: String)
java.bytesToStr(bytes: ByteArray, charset: String)

java.base64Decode(str: String, charset: String)
java.base64Encode(str: String, flags: Int)
java.timeFormatUTC(time: Long, format: String, sh: Int): String?

//è½¬ä¸ºç®€ä½“ï¼Œç¬¬äºŒä¸ªç›¸å
java.t2s(text: String): String
java.s2t(text: String): String</pre>
<h3>bookå¯¹è±¡</h3>
<ul>
    <li><code>bookUrl</code> - è¯¦æƒ…é¡µUrlæˆ–è·¯å¾„</li>
    <li><code>tocUrl</code> - ç›®å½•é¡µUrl</li>
    <li><code>origin</code> - ä¹¦æºURL</li>
    <li><code>originName</code> - ä¹¦æºåç§°æˆ–æ–‡ä»¶å</li>
    <li><code>name</code> - ä¹¦ç±åç§°(ä¹¦æºè·å–)</li>
    <li><code>author</code> - ä½œè€…åç§°(ä¹¦æºè·å–)</li>
    <li><code>kind</code> - åˆ†ç±»ä¿¡æ¯(ä¹¦æºè·å–)</li>
    <li><code>coverUrl</code> - å°é¢Url(ä¹¦æºè·å–)</li>
    <li><code>intro</code> - ç®€ä»‹å†…å®¹(ä¹¦æºè·å–)</li>
    <li><code>type</code> - 0:text 1:audio</li>
    <li><code>group</code> - è‡ªå®šä¹‰åˆ†ç»„ç´¢å¼•å·</li>
    <li><code>latestChapterTime</code> - æœ€æ–°ç« èŠ‚æ ‡é¢˜æ›´æ–°æ—¶é—´</li>
    <li><code>lastCheckTime</code> - æœ€è¿‘ä¸€æ¬¡æ›´æ–°ä¹¦ç±ä¿¡æ¯çš„æ—¶é—´</li>
    <li><code>canUpdate</code> - åˆ·æ–°ä¹¦æ¶æ—¶æ›´æ–°ä¹¦ç±ä¿¡æ¯</li>
    <li><code>variable</code> - è‡ªå®šä¹‰å˜é‡</li>
</ul>
<h3>chapterå¯¹è±¡</h3>
<ul>
    <li><code>url</code> - ç« èŠ‚åœ°å€</li>
    <li><code>title</code> - ç« èŠ‚æ ‡é¢˜</li>
    <li><code>baseUrl</code> - ç”¨æ¥æ‹¼æ¥ç›¸å¯¹url</li>
    <li><code>bookUrl</code> - ä¹¦ç±åœ°å€</li>
    <li><code>variable</code> - å˜é‡</li>
</ul>
<h3>sourceç±»éƒ¨åˆ†å‡½æ•°</h3>
<pre>source.getKey() //è·å–æºurl

//æºå˜é‡
source.setVariable(variable: String?)
source.getVariable()

//è¯·æ±‚å¤´
source.getLoginHeader()
source.getLoginHeaderMap().get(key: String)
source.putLoginHeader(header: String)
source.removeLoginHeader()

//ç™»å½•ä¿¡æ¯
source.getLoginInfo()
source.getLoginInfoMap().get(key: String)
source.removeLoginInfo()</pre>
<h3>cookieå¯¹è±¡çš„éƒ¨åˆ†å¯ç”¨å‡½æ•°</h3>
<pre>cookie.getCookie(url)
cookie.getKey(url, key)
cookie.setCookie(url, cookie)
cookie.replaceCookie(url, cookie)
cookie.removeCookie(url)</pre>
<h3>cacheå¯¹è±¡çš„éƒ¨åˆ†å¯ç”¨å‡½æ•°</h3>
<pre>cache.deleteMemory(key: String)
cache.getFromMemory(key: String): Any?
cache.putMemory(key: String, value: Any)</pre>
<h2><code>{{}}</code>çš„ä½¿ç”¨</h2>
<p>æœç´¢URLä¸å‘ç°URLä¸­åªèƒ½ä½¿ç”¨jsï¼Œä¸”æœ‰pageå’Œkeyå˜é‡ï¼Œå‰è€…ä¸ºé¡µæ•°ï¼Œä»1å¼€å§‹ï¼Œåè€…ä¸ºæœç´¢å…³é”®è¯ã€‚</p>
<p>å…¶ä»–åœ°æ–¹åº”è¯¥åœ¨å¯¹åº”è§„åˆ™å‰åŠ æ ‡è¯†ï¼ŒDefaultè§„åˆ™éœ€è¦ä»¥<code>@@</code>å¼€å¤´ï¼ŒXPathéœ€è¦ä»¥<code>@xpath:</code>æˆ–<code>//</code>å¼€å¤´ï¼ŒJSONPathéœ€è¦ä»¥<code>@json:</code>æˆ–<code>$.</code>å¼€å¤´ï¼ŒCSSéœ€è¦ä»¥<code>@css:</code>å¼€å¤´ã€‚</p>
<p>ä»»ä½•ä¸urlç›¸å…³çš„åœ°æ–¹éƒ½å¯ä»¥è¿”å›<code>'{{è¿™é‡Œæ˜¯ä»£ç }}'</code>ï¼Œé˜…è¯»ä¼šè§£æurlå¹¶æ‰§è¡Œ</p>
<h2>å˜é‡putä¸get</h2>
<p>åªæœ‰ä½¿ç”¨JSONPathä¸éœ€è¦åŠ å¼•å·ï¼š</p>
<pre>@put:{bid:"@@class.pid@text"}
@get:{bid}</pre>

<h2>è°ƒç”¨javaå‡½æ•°</h2>
<p>å¯ä»¥å¦‚<code>io.legado.app.utils.htmlFormat(str)</code>ä»¥åŒ…åå¼€å¤´ï¼Œæˆ–å¯¼å…¥åŒ…ï¼Œä»¥<code>Packages</code>å¼€å¤´ï¼š</p>
<pre>var javaImport = new JavaImporter();
javaImport.importPackage(Packages.java.lang);
with(javaImport) { ...... }</pre>
<h2>å‘ç°é¡µurlå¯ä»¥ä¸º</h2>
<pre>é¦–é¡µ::/</pre>
<p>æˆ–</p>
<pre>[{"title": "é¦–é¡µ",
  "url": "/",
  "style": {
     "layout_flexGrow": 0,
     "layout_flexShrink": 1,
     "layout_alignSelf": "auto",
     "layout_flexBasisPercent": -1,
     "layout_wrapBefore": true
  }
}]</pre>
<h2>ä¸€äº›æœ‰ç”¨çš„ä»£ç ç‰‡æ®µå’Œæ€è·¯</h2>
    <li>å¯¹äºæŸäº›è§†é¢‘æºï¼Œå¸Œæœ›ç›´æ¥å¼¹å‡ºæµè§ˆå™¨è§‚çœ‹ï¼Œå¯ä»¥ç”¨è¿™ä¸ª(è®¾ç½®äº†é™éŸ³è‡ªåŠ¨æ’­æ”¾)ï¼š</li>
    <p>æ­£æ–‡è§„åˆ™:</p>
    <pre>[åŒ…å«è§†é¢‘é“¾æ¥çš„å…ƒç´ ]@html
@js:const regex = /url=(.*?)"/;
const url = result.match(regex)[1];
const html = `data:text/html;charset=utf-8,&lt;html&gt;&lt;head&gt;&lt;meta name="viewport" content="width=device-width"&gt;&lt;style&gt;body {display: flex;justify-content: center;align-items: center;background-color: black;margin: 0;}video {max-width: 100%;max-height: 100%;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;video controls autoplay muted&gt;&lt;source src="${url}"&gt;&lt;/video&gt;&lt;/body&gt;&lt;/html&gt;`;
java.startBrowser(html, java.get('t'));
' ã€åˆ·æ–°æ­£æ–‡ã€‘æˆ–ã€ç‚¹å‡»ç« èŠ‚é“¾æ¥ã€‘è·³è½¬æ’­æ”¾\nğŸ”—ç›´é“¾:\n' + url
    </pre>
    <li>å¯¹äºæŸäº›æœç´¢æˆ–å‘ç°ä¸‹ä¸€é¡µurlä½äºé¡µé¢ä¸­ï¼Œå¯ä»¥ç”¨è¿™ä¸ªï¼š</li>
    <pre>//å°†æœç´¢æˆ–å‘ç°urlæ”¹ä¸º
{{page == 1 ? 'è¿™é‡Œæ˜¯åŸæœ¬çš„url' + key : cache.getFromMemory('url')}}
//åœ¨ä¹¦ç±åˆ—è¡¨è§„åˆ™ååŠ ä¸Š
@js:cache.putMemory('url', java.getElement('è¿™é‡Œæ˜¯ä¸‹ä¸€é¡µé“¾æ¥æ‰€åœ¨å…ƒç´ çš„è§„åˆ™')); result</pre>
    <li>å¦‚æœç›®å½•ä¸‹ä¸€é¡µå˜åŒ–æ¯”è¾ƒå¤šï¼Œä¸å¥½å†™ï¼Œå¯ä»¥è·å–æ€»å…±æœ‰å¤šå°‘é¡µï¼Œæ„é€ æ‰€æœ‰é¡µçš„urlå¹¶è¿”å›urlæ•°ç»„ã€‚</li>
</body>
</html>
